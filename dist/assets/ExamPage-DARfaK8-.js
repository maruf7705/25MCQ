var ne=Object.defineProperty,ae=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var Y=(s,t,n)=>t in s?ne(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n,I=(s,t)=>{for(var n in t||(t={}))ie.call(t,n)&&Y(s,n,t[n]);if(W)for(var n of W(t))ce.call(t,n)&&Y(s,n,t[n]);return s},O=(s,t)=>ae(s,re(t));var T=(s,t,n)=>new Promise((a,c)=>{var i=l=>{try{d(n.next(l))}catch(m){c(m)}},r=l=>{try{d(n.throw(l))}catch(m){c(m)}},d=l=>l.done?a(l.value):Promise.resolve(l.value).then(i,r);d((n=n.apply(s,t)).next())});import{r as o,j as e,b as le}from"./vendor-CKlhejSV.js";import{r as Z,a as oe,s as de,b as P,l as ue}from"./admin-CycKLZwY.js";import"./html2canvas-CIV5arX1.js";import"./katex-DJtWuuRl.js";function me({examName:s,timeLeft:t,totalQuestions:n}){const{minutes:a,seconds:c,colorClass:i}=o.useMemo(()=>{const r=Math.floor(t/60),d=t%60;let l="timer-green";return t<180?l="timer-red":t<540&&(l="timer-yellow"),{minutes:String(r).padStart(2,"0"),seconds:String(d).padStart(2,"0"),colorClass:l}},[t]);return e.jsx("header",{className:"exam-header",children:e.jsxs("div",{className:"exam-header-content",children:[e.jsx("h1",{className:"exam-title bengali",children:s}),e.jsxs("div",{className:`timer ${i} bengali`,children:[a,":",c]})]})})}function he(s,t,n=50){const a=o.useRef(null),c=o.useRef(null),i=n;return{onTouchStart:m=>{c.current=null,a.current=m.targetTouches[0].clientX},onTouchMove:m=>{c.current=m.targetTouches[0].clientX},onTouchEnd:()=>{if(!a.current||!c.current)return;const m=a.current-c.current,b=m>i,f=m<-i;b&&s&&s(),f&&t&&t()}}}function ge({question:s,questionNumber:t,selectedAnswer:n,onAnswerSelect:a,onPrev:c,onNext:i,canGoPrev:r,canGoNext:d,isMarked:l,onToggleMark:m,onSubmit:b}){const f=he(()=>d&&i(),()=>r&&c());return s?e.jsxs("div",O(I({className:"question-card"},f),{children:[e.jsxs("div",{className:"question-header",children:[e.jsxs("span",{className:"question-badge bengali",children:["‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ",t]}),l&&e.jsx("span",{className:"review-badge bengali",children:"‡¶∞‡¶ø‡¶≠‡¶ø‡¶â"})]}),e.jsx("div",{className:"question-text bengali",dangerouslySetInnerHTML:{__html:Z(s.question)}}),s.hasDiagram&&s.svg_code&&e.jsx("div",{className:"question-diagram",dangerouslySetInnerHTML:{__html:s.svg_code}}),e.jsx("div",{className:"options-grid",children:s.options.map(h=>{const N=n===h.id;return e.jsxs("button",{className:`option-card ${N?"selected":""}`,onClick:()=>a(s.id,h.id),children:[e.jsxs("span",{className:"option-label",children:[h.id,")"]}),e.jsx("span",{className:"option-text bengali",dangerouslySetInnerHTML:{__html:Z(h.text)}}),N&&e.jsx("span",{className:"check-icon",children:"‚úì"})]},h.id)})}),e.jsxs("div",{className:"question-actions",children:[e.jsxs("button",{className:"action-btn secondary",onClick:m,children:[l?"‚úì ":"",e.jsx("span",{className:"bengali",children:"‡¶∞‡¶ø‡¶≠‡¶ø‡¶â"})]}),e.jsxs("div",{className:"nav-buttons",children:[e.jsxs("button",{className:"action-btn",onClick:c,disabled:!r,children:["‚Üê ",e.jsx("span",{className:"bengali",children:"‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞"})]}),d?e.jsxs("button",{className:"action-btn primary",onClick:i,children:[e.jsx("span",{className:"bengali",children:"‡¶™‡¶∞‡ßá‡¶∞"})," ‚Üí"]}):e.jsx("button",{className:"action-btn primary submit-btn",onClick:b,children:e.jsx("span",{className:"bengali",children:"‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü"})})]})]})]})):null}function xe({totalQuestions:s,currentIndex:t,answers:n,questions:a,visitedQuestions:c,markedQuestions:i,onQuestionJump:r}){function d(l){const m=a[l];if(!m)return"unvisited";const b=n[m.id]!==void 0,f=c.has(l),h=i.has(l);return l===t?"active":h?"marked":b?"answered":f?"visited":"unvisited"}return e.jsxs("aside",{className:"sidebar-grid",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("h3",{className:"bengali",children:"‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶®"}),e.jsxs("div",{className:"status-legend-grid",children:[e.jsxs("div",{className:"status-item unvisited",children:[e.jsx("div",{className:"status-indicator"}),e.jsx("span",{className:"status-label",children:"‡¶Ö‡¶¶‡ßá‡¶ñ‡¶æ"})]}),e.jsxs("div",{className:"status-item visited",children:[e.jsx("div",{className:"status-indicator"}),e.jsx("span",{className:"status-label",children:"‡¶¶‡ßá‡¶ñ‡¶æ"})]}),e.jsxs("div",{className:"status-item answered",children:[e.jsx("div",{className:"status-indicator"}),e.jsx("span",{className:"status-label",children:"‡¶â‡¶§‡ßç‡¶§‡¶∞"})]}),e.jsxs("div",{className:"status-item marked",children:[e.jsx("div",{className:"status-indicator"}),e.jsx("span",{className:"status-label",children:"‡¶∞‡¶ø‡¶≠‡¶ø‡¶â"})]})]})]}),e.jsx("div",{className:"questions-grid",children:Array.from({length:s},(l,m)=>{const b=d(m);return e.jsx("button",{className:`question-bubble ${b}`,onClick:()=>r(m),title:`‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${m+1}`,children:m+1},m)})})]})}function se({status:s,retryCount:t,nextRetryIn:n,error:a}){const[c,i]=o.useState(!0),[r,d]=o.useState(!1);if(o.useEffect(()=>{if(s==="success"){const h=setTimeout(()=>{i(!1)},3e3);return()=>clearTimeout(h)}else i(!0)},[s]),o.useEffect(()=>{d(!1)},[s]),s==="idle"||s==="success"&&!c||r)return null;const l=()=>{d(!0)},m=()=>{switch(s){case"success":return"‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá";case"submitting":return t===0?"‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶™‡¶§‡ßç‡¶∞ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...":`‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶Ø‡¶º ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá (${t})...`;case"retrying":return`‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§ ${Math.ceil(n/1e3)} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶Ø‡¶º ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá... (‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ${t}/10)`;case"failed":return"‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";default:return"‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá..."}},b=()=>{switch(s){case"success":return null;case"submitting":return null;case"retrying":return null;case"failed":return null;default:return null}},f=s==="failed"?"error":s==="retrying"?"warning":s==="success"?"success":"info";return e.jsxs("div",{className:`submission-status ${f}`,children:[e.jsxs("div",{className:"submission-status-content",children:[b()&&e.jsx("span",{className:"submission-icon",children:b()}),e.jsx("span",{className:"submission-text bengali",children:m()}),e.jsx("button",{className:"submission-close-btn",onClick:l,"aria-label":"Close notification",children:"√ó"})]}),s==="retrying"&&e.jsx("div",{className:"submission-progress",children:e.jsx("div",{className:"progress-bar",style:{animationDuration:`${n}ms`}})})]})}function fe({score:s,accuracy:t}){const a=t>=90?{type:"gold",icon:"G",title:"‡¶∏‡ßç‡¶¨‡¶∞‡ßç‡¶£ ‡¶™‡¶¶‡¶ï",subtitle:"‡¶Ö‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£!",gradient:"var(--gradient-gold)"}:t>=75?{type:"silver",icon:"S",title:"‡¶∞‡ßå‡¶™‡ßç‡¶Ø ‡¶™‡¶¶‡¶ï",subtitle:"‡¶ö‡¶Æ‡ßé‡¶ï‡¶æ‡¶∞!",gradient:"var(--gradient-silver)"}:t>=60?{type:"bronze",icon:"B",title:"‡¶¨‡ßç‡¶∞‡ßã‡¶û‡ßç‡¶ú ‡¶™‡¶¶‡¶ï",subtitle:"‡¶≠‡¶æ‡¶≤‡ßã!",gradient:"var(--gradient-bronze)"}:{type:"participation",icon:"P",title:"‡¶Ö‡¶Ç‡¶∂‡¶ó‡ßç‡¶∞‡¶π‡¶£",subtitle:"‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ö‡¶æ‡¶≤‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶®!",gradient:"var(--gradient-primary)"};return e.jsxs("div",{className:`achievement-badge ${a.type}`,children:[e.jsx("div",{className:"badge-glow"}),e.jsx("div",{className:"badge-icon",children:a.icon}),e.jsxs("div",{className:"badge-content",children:[e.jsx("div",{className:"badge-title bengali",children:a.title}),e.jsx("div",{className:"badge-subtitle bengali",children:a.subtitle})]})]})}function be({correct:s,wrong:t,unanswered:n}){const a=o.useRef(null),c=s+t+n;return o.useEffect(()=>{const i=a.current;if(!i)return;const r=i.getContext("2d"),d=i.width/2,l=i.height/2,m=70;r.clearRect(0,0,i.width,i.height);const b=s/c*2*Math.PI,f=t/c*2*Math.PI;let h=-Math.PI/2;s>0&&(r.beginPath(),r.arc(d,l,m,h,h+b),r.lineTo(d,l),r.fillStyle="#10b981",r.fill(),h+=b),t>0&&(r.beginPath(),r.arc(d,l,m,h,h+f),r.lineTo(d,l),r.fillStyle="#ef4444",r.fill(),h+=f),n>0&&(r.beginPath(),r.arc(d,l,m,h,h+n/c*2*Math.PI),r.lineTo(d,l),r.fillStyle="#9ca3af",r.fill()),r.beginPath(),r.arc(d,l,m-30,0,2*Math.PI),r.fillStyle="white",r.fill()},[s,t,n,c]),e.jsxs("div",{className:"performance-chart",children:[e.jsx("h3",{className:"chart-title bengali",children:"‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¨‡¶®‡ßç‡¶ü‡¶®"}),e.jsxs("div",{className:"chart-container",children:[e.jsx("canvas",{ref:a,width:"200",height:"200",className:"chart-canvas"}),e.jsxs("div",{className:"chart-center",children:[e.jsx("div",{className:"chart-total",children:c}),e.jsx("div",{className:"chart-label bengali",children:"‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®"})]})]}),e.jsxs("div",{className:"chart-legend",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot correct"}),e.jsxs("span",{className:"legend-text bengali",children:["‡¶∏‡¶†‡¶ø‡¶ï (",s,")"]})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot wrong"}),e.jsxs("span",{className:"legend-text bengali",children:["‡¶≠‡ßÅ‡¶≤ (",t,")"]})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot unanswered"}),e.jsxs("span",{className:"legend-text bengali",children:["‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶π‡ßÄ‡¶® (",n,")"]})]})]})]})}function pe({questions:s,answers:t,studentName:n,score:a,onRestart:c,questionFile:i,submissionStatus:r}){const{score:d,correct:l,wrong:m,attempted:b,total:f}=a,h=b>0?(l/b*100).toFixed(1):0,N=f-b,S=d>=12.5,[v,Q]=o.useState([]),[M,F]=o.useState(null),[w,$]=o.useState("all"),[H,z]=o.useState(0),[G,L]=o.useState(0),R=o.useRef(!1);o.useEffect(()=>{E(),R.current||(R.current=!0,_(z,l),_(L,m))},[]);function _(x,p){const k=p/30;let J=0;const te=setInterval(()=>{J+=k,J>=p?(x(p),clearInterval(te)):x(Math.floor(J))},1e3/30)}function E(){return T(this,null,function*(){try{const y=(i||"questions.json").replace(".json","").replace(/\s+/g,"")+"-Answer.json",C=yield fetch(`/${y}`,{cache:"no-store"});if(!C.ok)return;const k=yield C.json();Q(k)}catch(x){console.log("Could not load solutions:",x)}})}function D(x){var p;return((p=v.find(y=>y.id===x||y.id.toString()===x.toString()))==null?void 0:p.solution)||null}function u(x){F(M===x?null:x)}function g(){return h>=90?"‡¶Ö‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£! ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶ö‡¶Æ‡ßé‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡¶õ‡ßã!":h>=75?"‡¶ñ‡ßÅ‡¶¨ ‡¶≠‡¶æ‡¶≤‡ßã! ‡¶ö‡¶Æ‡ßé‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú!":h>=60?"‡¶≠‡¶æ‡¶≤‡ßã ‡¶ï‡¶∞‡ßá‡¶õ‡ßã! ‡¶è‡¶ó‡¶ø‡¶Ø‡¶º‡ßá ‡¶ö‡¶≤‡ßã!":S?"‡¶™‡¶æ‡¶∏ ‡¶ï‡¶∞‡ßá‡¶õ‡ßã! ‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®!":"‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ‡¶§‡ßá ‡¶Ü‡¶∞‡¶ì ‡¶≠‡¶æ‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßá!"}function j(){return s.filter(x=>{const p=t[x.id],y=p===x.correctOptionId,C=p!==void 0;return w==="correct"?y:w==="wrong"?C&&!y:w==="unanswered"?!C:!0})}return e.jsxs("div",{className:"result-summary",children:[e.jsxs("div",{className:"result-card",children:[e.jsxs("div",{className:"result-header",children:[e.jsx("h1",{className:"bengali",children:"‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®"}),e.jsx("p",{className:"student-name bengali",children:n}),e.jsx("p",{className:"congratulations-message bengali",children:g()})]}),e.jsx(fe,{score:d,accuracy:parseFloat(h)}),e.jsxs("div",{className:"score-and-chart-container",children:[e.jsxs("div",{className:`score-display ${S?"pass":"fail"}`,children:[e.jsxs("div",{className:"progress-ring",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 200 200",children:[e.jsx("circle",{className:"progress-circle-bg",cx:"100",cy:"100",r:"85"}),e.jsx("circle",{className:"progress-circle",cx:"100",cy:"100",r:"85",style:{strokeDasharray:`${d/31.25*534} 534`}})]}),e.jsxs("div",{className:"score-content",children:[e.jsx("div",{className:"score-value",children:d.toFixed(2)}),e.jsxs("div",{className:"score-label bengali",children:["‡¶Æ‡ßã‡¶ü: ",f]})]})]}),e.jsx("div",{className:`status-badge ${S?"pass":"fail"}`,children:S?"‡¶™‡¶æ‡¶∏":"‡¶´‡ßá‡¶≤"})]}),e.jsx(be,{correct:l,wrong:m,unanswered:N})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-item correct-stat",children:[e.jsx("div",{className:"stat-value correct",children:H}),e.jsx("div",{className:"stat-label bengali",children:"‡¶∏‡¶†‡¶ø‡¶ï"})]}),e.jsxs("div",{className:"stat-item wrong-stat",children:[e.jsx("div",{className:"stat-value wrong",children:G}),e.jsx("div",{className:"stat-label bengali",children:"‡¶≠‡ßÅ‡¶≤"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-value",children:b}),e.jsx("div",{className:"stat-label bengali",children:"‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsxs("div",{className:"stat-value",children:[h,"%"]}),e.jsx("div",{className:"stat-label bengali",children:"‡¶∏‡¶†‡¶ø‡¶ï‡¶§‡¶æ"})]})]}),e.jsxs("div",{className:"answers-review",children:[e.jsx("h2",{className:"bengali",children:"‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶®‡¶æ"}),e.jsxs("div",{className:"filter-buttons",children:[e.jsx("button",{className:`filter-btn ${w==="all"?"active":""}`,onClick:()=>$("all"),children:e.jsxs("span",{className:"bengali",children:["‡¶∏‡¶¨ (",s.length,")"]})}),e.jsx("button",{className:`filter-btn ${w==="correct"?"active":""}`,onClick:()=>$("correct"),children:e.jsxs("span",{className:"bengali",children:["‡¶∏‡¶†‡¶ø‡¶ï (",l,")"]})}),e.jsx("button",{className:`filter-btn ${w==="wrong"?"active":""}`,onClick:()=>$("wrong"),children:e.jsxs("span",{className:"bengali",children:["‡¶≠‡ßÅ‡¶≤ (",m,")"]})}),e.jsx("button",{className:`filter-btn ${w==="unanswered"?"active":""}`,onClick:()=>$("unanswered"),children:e.jsxs("span",{className:"bengali",children:["‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶π‡ßÄ‡¶® (",N,")"]})})]}),e.jsx("div",{className:"answers-list",children:j().map((x,p)=>{const y=t[x.id],C=y===x.correctOptionId,k=y!==void 0;return e.jsxs("div",{className:`answer-item ${C?"correct":k?"wrong":"unanswered"}`,children:[e.jsxs("div",{className:"answer-header",children:[e.jsxs("span",{className:"question-num bengali",children:["‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ",p+1]}),C&&e.jsx("span",{className:"icon-check"}),k&&!C&&e.jsx("span",{className:"icon-cross"}),!k&&e.jsx("span",{className:"icon-dash"})]}),e.jsx("div",{className:"question-text bengali",children:x.question}),e.jsx("div",{className:"answer-details",children:k?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"bengali",children:["‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞: ",y]}),e.jsxs("span",{className:"bengali",children:["‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞: ",x.correctOptionId]})]}):e.jsx("span",{className:"bengali",children:"‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø"})}),D(x.id)&&e.jsxs("div",{className:"solution-toggle-section",children:[e.jsx("button",{className:"solution-toggle-btn bengali",onClick:()=>u(x.id),children:M===x.id?"‚ñº ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®":"‚ñ∂ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®"}),M===x.id&&e.jsxs("div",{className:"solution-box",children:[e.jsx("div",{className:"solution-header bengali",children:e.jsx("strong",{children:"‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶®/‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ"})}),e.jsx("div",{className:"solution-text bengali",children:D(x.id)})]})]})]},x.id)})})]}),e.jsx("button",{className:"restart-btn bengali",onClick:c,children:"‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®"})]}),e.jsx(se,I({},r))]})}const U="exam_submission_queue",V=10,je=2e3;function Ne(s){const t=B(),n=`${s.studentName}_${Date.now()}`,a={id:n,payload:s,timestamp:new Date().toISOString(),retryCount:0,status:"pending"};return t.push(a),localStorage.setItem(U,JSON.stringify(t)),console.log("üìù Queued submission:",n),n}function B(){try{const s=localStorage.getItem(U);return s?JSON.parse(s):[]}catch(s){return console.error("Failed to load submission queue:",s),[]}}function ve(s){const n=B().filter(a=>a.id!==s);localStorage.setItem(U,JSON.stringify(n)),console.log("‚úÖ Cleared submission from queue:",s)}function K(s,t){const a=B().map(c=>c.id===s?I(I({},c),t):c);localStorage.setItem(U,JSON.stringify(a))}function Se(s){return Math.min(je*Math.pow(2,s),6e4)}function X(s,t){return T(this,null,function*(){const{id:n,payload:a,retryCount:c=0}=s;if(c>=V)return console.error("‚ùå Max retries reached for:",n),K(n,{status:"failed",lastError:"Max retries exceeded"}),t==null||t({status:"failed",retryCount:c,error:"Max retries exceeded"}),{success:!1,error:"Max retries exceeded"};try{t==null||t({status:"submitting",retryCount:c});try{yield oe(a.studentName),console.log("‚úì Removed from pending list:",a.studentName)}catch(r){console.warn("Could not remove from pending list (continuing):",r.message)}const i=yield de(a);return ve(n),t==null||t({status:"success",retryCount:c}),console.log("‚úÖ Submission successful:",n),{success:!0,result:i}}catch(i){console.warn(`‚ö†Ô∏è Submission failed (attempt ${c+1}/${V}):`,i.message);const r=c+1;if(K(n,{retryCount:r,lastError:i.message,lastAttempt:new Date().toISOString()}),r<V){const d=Se(r);return t==null||t({status:"retrying",retryCount:r,nextRetryIn:d}),yield new Promise(l=>setTimeout(l,d)),X(O(I({},s),{retryCount:r}),t)}else return K(n,{status:"failed"}),t==null||t({status:"failed",retryCount:r,error:i.message}),{success:!1,error:i.message}}})}function ye(s){return T(this,null,function*(){const t=B();if(t.length===0)return console.log("No pending submissions in queue"),[];console.log(`üì§ Processing ${t.length} pending submission(s)...`);const n=[];for(const a of t){const c=yield X(a,s);n.push(I({id:a.id},c))}return n})}function we(s){let t=!1;const n=()=>T(this,null,function*(){if(!t){t=!0;try{yield ye(s)}catch(c){console.error("Background sync error:",c)}finally{t=!1}}}),a=()=>{console.log("üåê Network reconnected, attempting to sync..."),n()};return window.addEventListener("online",a),n(),()=>{window.removeEventListener("online",a)}}const A={RUNNING:"RUNNING",SUBMITTED:"SUBMITTED"},q=18*60,ee=1.25,Ce=.25,Ie=12.5;function Ee({questions:s,studentName:t,questionFile:n="questions.json"}){console.log("MCQContainer rendered:",{hasQuestions:!!s,isArray:Array.isArray(s),length:s==null?void 0:s.length,studentName:t});const[a,c]=o.useState(A.RUNNING),[i,r]=o.useState(0),[d,l]=o.useState({}),[m,b]=o.useState(new Set([0])),[f,h]=o.useState(q),[N,S]=o.useState(new Set),[v]=o.useState(Date.now()),[Q,M]=o.useState(!1),[F,w]=o.useState({status:"idle",retryCount:0}),$=o.useCallback((u,g)=>{l(j=>O(I({},j),{[u]:g})),b(j=>new Set([...j,i]))},[i]),H=o.useCallback(u=>{s&&u>=0&&u<s.length&&(r(u),b(g=>new Set([...g,u])))},[s]),z=o.useCallback(()=>{i>0&&r(u=>{const g=u-1;return b(j=>new Set([...j,g])),g})},[i]),G=o.useCallback(()=>{s&&i<s.length-1&&r(u=>{const g=u+1;return b(j=>new Set([...j,g])),g})},[i,s]),L=o.useCallback(()=>{S(u=>{const g=new Set(u);return g.has(i)?g.delete(i):g.add(i),g})},[i]),R=o.useCallback(()=>{if(!s||!Array.isArray(s))return{score:0,correct:0,wrong:0,attempted:0,total:0};let u=0,g=0;return s.forEach(x=>{const p=d[x.id];p&&(p===x.correctOptionId?u++:g++)}),{score:Math.max(u*ee-g*Ce,0),correct:u,wrong:g,attempted:u+g,total:s.length}},[s,d]),_=o.useCallback(()=>T(this,null,function*(){if(a===A.SUBMITTED)return;const u=R(),g={studentName:t,answers:d,score:parseFloat(u.score.toFixed(2)),totalMarks:u.total*ee,timestamp:new Date().toISOString(),attempted:u.attempted,correct:u.correct,wrong:u.wrong,pass:u.score>=Ie,questionFile:n},j=Ne(g);console.log("üìù Submission queued locally:",j),c(A.SUBMITTED),X({id:j,payload:g,retryCount:0},p=>{w(p),p.status==="success"&&localStorage.removeItem(`mcq_state_${t}`)}).catch(p=>{console.error("Submission error:",p)})}),[a,t,d,s,R,n]);if(o.useEffect(()=>{var g;if(!s||s.length===0)return;const u=localStorage.getItem(`mcq_state_${t}`);if(u)try{const j=JSON.parse(u);l(j.answers||{});const x=Math.max(0,s.length-1);r(Math.min(j.currentIndex||0,x)),h((g=j.timeLeft)!=null?g:q),b(new Set(j.visited||[0])),S(new Set(j.marked||[]))}catch(j){console.error("Failed to load saved state",j)}},[t,s]),o.useEffect(()=>{if(a===A.RUNNING){const u={answers:d,currentIndex:i,timeLeft:f,visited:Array.from(m),marked:Array.from(N)};localStorage.setItem(`mcq_state_${t}`,JSON.stringify(u))}},[d,i,f,m,N,a,t]),o.useEffect(()=>{if(a!==A.RUNNING||f<=0)return;const u=setInterval(()=>{h(g=>g<=1?(_(),0):g-1)},1e3);return()=>clearInterval(u)},[a,f,_]),o.useEffect(()=>{s&&s.length>0&&(i<0||i>=s.length)&&r(0)},[i,s]),o.useEffect(()=>{if(a!==A.RUNNING)return;const u=1*60*1e3,g=5*60*1e3,j=setTimeout(()=>{Q||(M(!0),P(t,v).then(()=>{console.log(`${t} marked as pending after 1 minute`)}).catch(p=>console.error("Failed to save pending student (1 min):",p)))},u),x=setInterval(()=>{P(t,v).then(()=>{console.log(`Heartbeat: ${t} is still taking exam`)}).catch(p=>console.error("Failed to send heartbeat:",p))},g);return()=>{clearTimeout(j),clearInterval(x)}},[a,Q,v,t]),o.useEffect(()=>we(g=>{w(g)}),[]),!s||!Array.isArray(s)||s.length===0)return console.error("MCQContainer: Invalid questions array",{questions:s}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",flexDirection:"column",gap:"16px",padding:"20px",backgroundColor:"var(--gray-50)"},children:[e.jsx("div",{style:{color:"var(--error)",fontSize:"18px",textAlign:"center"},className:"bengali",children:"‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ‡¶ü‡¶ø ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"}),e.jsx("div",{style:{color:"var(--gray-600)",fontSize:"14px",marginTop:"8px",textAlign:"center"},children:s?Array.isArray(s)?s.length===0?"Questions array is empty":"Unknown error":"Questions is not an array":"Questions is null/undefined"}),e.jsx("button",{onClick:()=>window.location.reload(),style:{padding:"12px 24px",backgroundColor:"var(--primary)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px",marginTop:"8px"},className:"bengali",children:"‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®"})]});if(a===A.SUBMITTED)return e.jsx(pe,{questions:s,answers:d,studentName:t,score:R(),onRestart:()=>window.location.reload(),questionFile:n,submissionStatus:F});const E=Math.max(0,Math.min(i,s.length-1)),D=s[E];if(!D)return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:e.jsx("div",{className:"bengali",children:"‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá..."})});try{return e.jsxs("div",{className:"mcq-container",children:[e.jsx(me,{examName:"MCQ Exam",timeLeft:f,totalQuestions:s.length}),e.jsxs("div",{className:"mcq-content",children:[e.jsx("div",{className:"question-section",children:e.jsx(ge,{question:D,questionNumber:E+1,selectedAnswer:d[D.id],onAnswerSelect:$,onPrev:z,onNext:G,canGoPrev:E>0,canGoNext:E<s.length-1,isMarked:N.has(E),onToggleMark:L,onSubmit:_})}),e.jsx(xe,{totalQuestions:s.length,currentIndex:E,answers:d,questions:s,visitedQuestions:m,markedQuestions:N,onQuestionJump:H})]}),e.jsx(se,I({},F))]})}catch(u){return console.error("MCQContainer render error:",u),e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",flexDirection:"column",gap:"16px",padding:"20px"},children:[e.jsxs("div",{style:{color:"var(--error)",fontSize:"18px"},className:"bengali",children:["‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ",u.message]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bengali",children:"‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®"})]})}}function ke({onStart:s}){const[t,n]=o.useState("");function a(c){c.preventDefault(),t.trim()&&s(t.trim())}return e.jsx("div",{className:"start-screen",children:e.jsxs("div",{className:"start-card",children:[e.jsx("h1",{className:"bengali",children:"MCQ Exam"}),e.jsxs("div",{className:"exam-info",children:[e.jsx("p",{className:"bengali",children:"‡¶∏‡¶Æ‡¶Ø‡¶º: ‡ßß‡ßÆ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü | ‡¶Æ‡ßã‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞: ‡ß©‡ßß.‡ß®‡ß´ | ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®: ‡ß®‡ß´"}),e.jsx("p",{className:"bengali",children:"‡¶∏‡¶†‡¶ø‡¶ï: +‡ßß.‡ß®‡ß´ | ‡¶≠‡ßÅ‡¶≤: -‡ß¶.‡ß®‡ß´ | ‡¶™‡¶æ‡¶∏ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï: ‡ßß‡ß®.‡ß´"})]}),e.jsxs("form",{onSubmit:a,children:[e.jsx("label",{htmlFor:"student-name",className:"bengali",children:"‡¶®‡¶æ‡¶Æ / ‡¶Ü‡¶á‡¶°‡¶ø"}),e.jsx("input",{id:"student-name",type:"text",value:t,onChange:c=>n(c.target.value),placeholder:"‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®",className:"bengali",autoFocus:!0}),e.jsx("button",{type:"submit",className:"primary-btn bengali",children:"‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®"}),e.jsx("p",{className:"hint bengali",children:"‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶® ‡¶®‡ßá‡¶á‡•§ ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"})]})]})})}class Me extends le.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,n){console.error("ErrorBoundary caught error:",t,n)}render(){var t;return this.state.hasError?e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",flexDirection:"column",gap:"16px",padding:"20px"},children:[e.jsx("div",{style:{color:"var(--error)",fontSize:"18px"},className:"bengali",children:"‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá"}),e.jsx("div",{style:{color:"var(--gray-600)",fontSize:"14px"},children:(t=this.state.error)==null?void 0:t.message}),e.jsx("button",{onClick:()=>window.location.reload(),style:{padding:"12px 24px",backgroundColor:"var(--primary)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer"},className:"bengali",children:"‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®"})]}):this.props.children}}function _e(){const[s,t]=o.useState(""),[n,a]=o.useState([]),[c,i]=o.useState("questions.json"),[r,d]=o.useState(!0),[l,m]=o.useState(null);o.useEffect(()=>{b()},[]);function b(){return T(this,null,function*(){try{const{file:f}=yield ue();i(f),console.log(`Loading questions from /${f}`);const h=yield fetch(`/${f}`,{cache:"no-store"});if(console.log("Fetch response:",{status:h.status,ok:h.ok}),!h.ok)throw new Error(`Failed to load questions: ${h.status} ${h.statusText}`);const N=yield h.json();if(console.log("Loaded questions data:",{isArray:Array.isArray(N),count:N==null?void 0:N.length}),!Array.isArray(N)||N.length===0)throw new Error("No questions found in file");const S=N.map(v=>({id:v.id,question:v.question,options:Object.entries(v.options).map(([Q,M])=>({id:Q,text:M})),correctOptionId:v.correctAnswer,explanation:`‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞: ${v.correctAnswer}. ${v.question}`,hasDiagram:v.hasDiagram||!1,svg_code:v.svg_code||null,subject:v.subject||""}));if(console.log("Transformed questions:",{count:S.length,firstQuestion:S[0]}),S.length===0)throw new Error("No valid questions found after processing");a(S),d(!1)}catch(f){console.error("Error loading questions:",f),m(f.message),d(!1)}})}return r?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:e.jsx("div",{children:"‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá..."})}):l?e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",flexDirection:"column",gap:"16px",padding:"20px",textAlign:"center"},children:[e.jsx("div",{style:{color:"var(--error)",fontSize:"18px"},className:"bengali",children:"‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá"}),e.jsx("div",{style:{color:"var(--gray-600)",fontSize:"14px",marginTop:"8px"},children:l}),e.jsx("button",{onClick:b,style:{padding:"12px 24px",backgroundColor:"var(--primary)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px",marginTop:"16px"},className:"bengali",children:"‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®"})]}):s?(console.log("ExamPage rendering MCQContainer:",{studentName:s,questionsCount:n.length,loading:r,error:l}),e.jsx(Me,{children:e.jsx(Ee,{questions:n,studentName:s,questionFile:c})})):e.jsx(ke,{onStart:f=>{t(f)}})}export{_e as default};
